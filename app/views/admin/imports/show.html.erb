<% if @report.processing? %>
  <meta http-equiv="refresh" content="3">
<% end %>

<div class="mx-auto max-w-2xl">
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-bold">Import Status</h1>
    <%= link_to "Back to Imports", admin_imports_path,
        class: "text-indigo-600 hover:text-indigo-500 text-sm" %>
  </div>

  <div class="bg-white shadow rounded-lg p-6">
    <dl class="grid grid-cols-2 gap-4 mb-6">
      <div>
        <dt class="text-sm font-medium text-gray-500">Type</dt>
        <dd class="text-sm text-gray-900 capitalize"><%= @report.import_type %></dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-gray-500">Status</dt>
        <dd><%= import_status_badge(@report) %></dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-gray-500">Started</dt>
        <dd class="text-sm text-gray-900"><%= time_ago_in_words(@report.created_at) %> ago</dd>
      </div>
      <% if @report.duration %>
        <div>
          <dt class="text-sm font-medium text-gray-500">Duration</dt>
          <dd class="text-sm text-gray-900"><%= @report.duration.round(1) %>s</dd>
        </div>
      <% end %>
    </dl>

    <% if @report.processing? %>
      <div class="flex items-center justify-center py-8">
        <svg class="animate-spin h-8 w-8 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
        </svg>
        <span class="ml-3 text-gray-600">Processing import...</span>
      </div>
    <% else %>
      <div class="border-t pt-4">
        <h3 class="font-medium mb-3">Results</h3>
        <div class="grid grid-cols-2 gap-4">
          <div class="bg-green-50 rounded-md p-4">
            <p class="text-2xl font-bold text-green-700"><%= @report.imported_count || 0 %></p>
            <p class="text-sm text-green-600">Imported</p>
          </div>
          <div class="bg-red-50 rounded-md p-4">
            <p class="text-2xl font-bold text-red-700"><%= @report.failed_count || 0 %></p>
            <p class="text-sm text-red-600">Failed</p>
          </div>
        </div>
      </div>

      <% if @report.row_errors.present? %>
        <div class="border-t pt-4 mt-4">
          <h3 class="font-medium mb-3">Row Errors</h3>
          <div class="bg-gray-50 rounded-md p-4 max-h-64 overflow-y-auto">
            <ul class="space-y-2 text-sm">
              <% @report.row_errors.each do |error| %>
                <li>
                  <span class="font-medium">Row <%= error["row"] %>:</span>
                  <span class="text-red-600"><%= error["error"] %></span>
                </li>
              <% end %>
            </ul>
          </div>
        </div>
      <% end %>

      <% if @report.error_messages.present? %>
        <div class="border-t pt-4 mt-4">
          <h3 class="font-medium mb-3">Import Errors</h3>
          <div class="bg-red-50 rounded-md p-4">
            <ul class="list-disc list-inside text-sm text-red-700">
              <% @report.error_messages.each do |error| %>
                <li><%= error %></li>
              <% end %>
            </ul>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
